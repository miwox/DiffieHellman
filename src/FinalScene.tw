:: FinalScene [bild]{"position":"175,700","size":"100,100"}
#Diffie Hellman The Game
(display:"Sidebar1")\
(set: _text1 to "Bob sent his calculated B to the stranger number. Just at that moment, there were several knocks on the door. This time Bob would find out who the mystery person was. His gun was on the table. He put it in pants and opened the door. His eyes enlarged in shock. A Hellsolider was at his door.")\
(set: _text2 to "The automatic rifle was pointed at him. Both were visibly confused. The Hellsolider had not expected the Resistance's most wanted criminal to answer the door, and Bob would not have expected a Hellsolider to be at his door. Bob threw himself to the side at just the right moment. Shots rang out from the AK-47 and penetrated the couch behind Bob. He aimed for his head and fired. The soldier was eliminated. He fell forward. A note was pinned to his back. Bob raised an eyebrow. The note had a simple A on it. He took the note and on the back was another long string of characters.")\
(set: _text3 to "Alice had tested him. Did she want to know if he was still one of the good guys? On the note he recognized the sentence in very small letters: If you make it to the mailbox, we'll see each other, you coward. He laughed and took the Hellsoldiers AK-47. Fortunately, it was not a new model with a fingerprint sensor. ")\
(set: _text4 to "In the hallway further back, he heard more enemies shouting. A smoke grenade fogged the hallway, but Bob didn't care. He fired blindly into the smoke. This was his terrain. He had small acoustic signals hidden everywhere, which told him the location of his opponents. There was a reason this building was called the Tartarus Complex. It was hell within hell. No Hellsoldier would get out of here alive. He pulled the fire alarm, now the entire resistance knew it was time to make the world shake. The resistance fought their way down floor by floor. They killed one Hellsoldier after another. When Bob was at the mailboxes, he felt a euphoria rising inside him. He looked for Alice but did not find her. After a closer look, Bob realized that one of the mailboxes was open and inside, of course, was another note. But now there was a sequence of characters again. Fuck you Alice, he said to himself. Now he'll have to calculate her key first and decode this shit.<br><br>[[CaluclateScene->CaluclateScene]] ")\
(set: _holder to "Continue...")\
<div class="storyteller">\
($continueTextClick: _text1, _holder, ($continueTextClick: _text2, _holder, ($continueTextClick: _text3, _holder,(print: _text4))))
</div>


:: CaluclateScene [bild]{"position":"175,700","size":"100,100"}
#Diffie Hellman The Game
(display:"Sidebar1")\
<div class="storyteller">
Bob must now calculate KA
<formular></formular>\
<script>
let latex = window.document.querySelector("formular");
latex.innerText = "\\(Bobs \\: Secret \\: Key \\: is \\: S_{Bob} =\\:" + $ALICE_PUBLICKEY_2 + "^{" + $BOBS_SECRET_2 + "}\\: \\: modulo \\: \\: " + $COMMON_PRIME_2 + "\\)";
</script>


        <label for="key">Key:</label>
        <input type="text" name="key" id="key" required/>
        <button onclick="calculateKey()">Calculate</button>
</div>
(display:"Refresh-Button")\

<div class="storyteller" id="hiddenResults" style="display: none;">
The string on the letter looks like this:
<p class ="results" id="ecnryptedStringWithBase64"></p>

After Base64 decoding
<p class ="results" id="ecnryptedString"></p>

Now we do a XOR with the ecnryptedString and our Key 
<p class ="results" id="keyInBinary"></p>
This is the binary of the string
<p class ="results" id="stringInBinary"></p>
And finally we need to to convert binary to String
<p class ="results" id="teststring"></p>
</div>

<script>


window.calculateKey = function(){
  //Example String
    let teststring ="Ich heiße der asdterwdsasdasd";
       let key = document.getElementById('key').value;
       //calculate the the key to check it against the user input 
       //chagne 5 5 
       let checkKey = Math.pow(5,5)%7;
       console.log(checkKey);
              if(key == checkKey){
                document.getElementById("hiddenResults").style.display="block";
                         let keyInBinary = stringToBinary(key);
                         let extendedKey = keyInBinary
                         let stringInBinary = stringToBinary(teststring);
                         //extend the key until it has the same size like the string
                         if (stringInBinary.length != keyInBinary.length && stringInBinary.length > keyInBinary.length){
                              var counter = 0;                           
                               while(stringInBinary.length != extendedKey.length){
                                extendedKey+=keyInBinary.charAt(counter);
                                if(counter==keyInBinary.length){
                                    counter = 0 ;
                                }else{
                                    counter++;
                                }
                               }

                         }
              console.log(extendedKey);
              console.log(stringInBinary)
              //build encrypted String with xor of binary of string and key
              let xorString ="";
              for(var i=0; i<stringInBinary.length; i++) {
              var value1 = stringInBinary[i];
              var value2 = extendedKey[i];
              var xorValue = value1 ^ value2;
              xorString+=xorValue;
               }
              console.log("Verschlüsselt")
              console.log(xorString);            
            
            /*    let entsch="";
            for(var i=0; i<xorString.length; i++) {
              var value1 = xorString[i];
              var value2 = extendedKey[i];
              var xorValue = value1 ^ value2;
              entsch+=xorValue;
               }
              var entcryptedString = window.binaryToString(entsch);
            console.log(entcryptedString);
            */

            let ecnryptedStringWithBase64 = btoa(xorString);
            let ecnryptedString = xorString;
            document.getElementById('teststring').innerHTML = teststring;
            document.getElementById('ecnryptedStringWithBase64').innerHTML = ecnryptedStringWithBase64;
            document.getElementById('ecnryptedString').innerHTML = ecnryptedString;
            document.getElementById('keyInBinary').innerHTML = extendedKey;
            document.getElementById('stringInBinary').innerHTML = stringInBinary;
            }
}
window.stringToBinary = function(input){
  var characters = input.split('');

  return characters.map(function(char) {
    const binary = char.charCodeAt(0).toString(2)
    const pad = Math.max(8 - binary.length, 0);
    // Just to make sure it is 8 bits long.
    return '0'.repeat(pad) + binary;
  }).join('');
}

window.binaryToString = function(input){

  let bytesLeft = input;
  let result = '';

  // Check if we have some bytes left
  while (bytesLeft.length) {
    // Get the first digits
    const byte = bytesLeft.substr(0, 8);
    bytesLeft = bytesLeft.substr(8);

    result += String.fromCharCode(parseInt(byte, 2));
  }

  return result;
}


</script>